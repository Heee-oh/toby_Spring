## 예외 처리 핵심 원칙 
- 모든예외는 적절하게 복구되든지 작업을 중단시키고 운영자 또는 개발자에게 분명하게 통보돼야 한다.


## 예외의 종류와 특징
- Error
  - java.lang.Error 클래스의 서브 클래스들
  - 시스템 비정상 상황 발생시
    - OutOfMemoryError or ThreadDeath
    - catch 블록으로 잡아봤자 대응 없음

- Exception 과 체크예외
  - java.lang.Exception 클래스와 그 서브 클래스
  - 체크와 언체크로 나뉨
  - RuntimeException 을 상속했다면 언체크
  - 체크 예외는 반드시 명시하여 던지거나 처리해야함

- RuntimeException 
  - java.lang.RuntimeException 클래스를 상속한 예외들
  - 명시적인 예외 처리 강제 X
  - 잡아서 처리할 필요도 없음


## 예외 복구
- 체크 예외들은 예외를 어떤 식으로든 복구할 가능성이 있는 경우에 사용
- DB의 경우 재시도가 예시

## 예외처리 회피
- 예외 처리를 자신을 호출한 쪽에 던지기
- throws 로 던지거나 예외를 잡은 뒤 로그 남기고 다시 던지기
- 다른 오브젝트에게 예외 처리 책임을 분명히 지게 하거나 자신을 사용하는 쪽에서 예외를 다루는 게 최선의 방법이라는 분명한 확신이 있어야함

## 예외 전환
- 복구 불가능, 밖으로 던지되 적절한 예외로 전환해서 던진다.
- 예외 전환의 2가지 목적
  1. 발생한 예외가 현재 상황에 적합한 의미를 가지지 못할때
     - 로그인 아이디 중복 -> SQLException (의미 불명확) -> DuplicateUserIdException(의미 있는 예외로 전환해서 던짐)
     - 중첩 예외로 전환하는 게 좋음 (원래 예외도 포함한다)
       - throw ..Exception(e); e가 원래 예외
       - throw ...Exception().initCause(e);
  2. 예외 처리를 처리하기 쉽고 단순하게 만들기 위해 포장
     - 체크 예외 -> 언체크 예외로 전환해서 던짐
     - 이때도 중첩 예외로 원래 예외를 포함


자바가 서버로 들어오면서 
대부분 런타임 예외로 전환해서 던지는게 유리해짐 
- 이유 : try-catch 삭제, throws 명시 X, 어디서 호출할 지 알 수 없음, 예외에 추가적인 내용 삽입 가능

### 애플리케이션 예외
시스템, 외부 예외 상황이 원인이 아닌 애플리케이션 로직 자체에 의해 의도적으로 발생시키고,
반드시 catch 해서 무엇인가 조치를 취하도록 요구하는 예외

즉, 비지니스 로직등에서 의도적으로 던지는 예외

### JDBC의 한계
- 비표준 SQL (DB마다 문법이 다 다름) 
- 호환성 없는 SQLException의 DB 에러 정보 (에러 코드가 DB마다 다름)
  - XOPEN SQL에서 SQL 상태 코드를 따르도록 주지만 이도 정확하지 않음

### JDBCTemplate의 대응
- DB별로 미리 준비된 에러 코드 매핑 파일이 있음 (sql-error-codes.xml)
- xml로 각 에러 코드에 대한 런타임 예외들을 지정함

### 스프링
DataAccessException 계층 예외로 
이를 상속한 여러 예외 추상클래스들이 존재


BadSqlGrammarException,"SQL 구문 오류 시 발생 (잘못된 테이블명, 컬럼명 등)"

DataIntegrityViolationException,"제약 조건 위반 (Primary Key 중복, Foreign Key 위반 등)"

DataAccessResourceFailureException,DB 연결 실패 등 리소스 자체에 문제가 있을 때

OptimisticLockingFailureException,낙관적 락(Optimistic Lock) 충돌 시 발생

EmptyResultDataAccessException,데이터를 기대했으나 결과가 없을 때 (예: queryForObject 호출 시)

각 추상 클래스들을 구현한 각 DB별 구현체가 존재함 (다형성)


## 동작 원리
1. DB 에러 발생, JDBC가 SQLException 던짐 (DB마다 ErrorCode 다름)
2. 스프링의 SQLErrorCodeSQLExceptionTranslator 가 해당 코드를 읽음
3. 해당 DB의 sql-error-codes.xml에 있는 코드를 보고 이에 해당하는 런타임 예외를 생성하여 던짐
